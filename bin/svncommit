#!/usr/bin/env bash 

CURRENT="`svn info | sed -n '/^Repository Root/s/[^:]*: //p'`"

set -e

if [ "${CURRENT:0:4}" = "svn:" ]; then
	WRITABLE="`sed 's/svn:/http:/;s,$,/dev,' <<< "$CURRENT"`"
	echo -n "Switching to writable repository..."
	svn switch --relocate "$CURRENT" "$WRITABLE"
	echo done
fi

svn commit "$@"

if [ -n "$WRITABLE" ]; then	
	echo -n "Switching back to read-only repository..."
	svn switch --relocate "$WRITABLE" "$CURRENT"
	echo done
fi
