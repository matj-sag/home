#!/usr/bin/env bash

FULL=

if [ "$1" == "--full" ]; then
	FULL=true
	shift
fi

BRANCH="$1"

set -e

if [ -z "$BRANCH" ]; then
	echo "Usage: svnco [--full] <branch>"
	exit 1
fi

if [ -n "$FULL" ]; then
	svn -q co svn://svn.apama.com/branches/$BRANCH
else
	svn -q co -N svn://svn.apama.com/branches/$BRANCH
fi
cd `basename $BRANCH`

if [ -e apama-lib2 ]; then
	true
elif [ -e /var/tmp/apama-lib2 ]; then
		ln -sf /var/tmp/apama-lib2 .
else
		ln -sf /shared/apamabld/apama-lib2 .
fi

if [ -z "$FULL" ]; then
	svn -q up -N apama-src apama-test
	FILES=$(cd apama-src; svn ls)
	(
		cd apama-src
		svn -q up $FILES
		echo "apama-src checked out" 
	) &
	(
		cd apama-test 
		svn -q up -N system etc doc examples unit
		svn -q up licences python_scripts tools utils
		cd unit
		svn -q up -N correlator-core  correlator-hypertree correlator-jmon cxxtest dsm junit lib samples studio
		svn -q up cpp-common dotNet-common iaf java-common osee remote-executables sender-merger tools
		echo "apama-test partially checked out"
	) &
	wait
fi
svn switch --relocate svn://svn.apama.com/branches/$BRANCH http://svn.apama.com/dev/branches/$BRANCH
echo "All done and switch to R/W repository"
